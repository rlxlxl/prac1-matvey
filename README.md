# Реляционная СУБД

Реализация простой реляционной системы управления базами данных на C++ с поддержкой SQL-запросов.

## Возможности

- **SELECT** - выборка данных из одной или нескольких таблиц (декартово произведение)
- **WHERE** - фильтрация с поддержкой операторов AND и OR
- **INSERT INTO** - вставка новых строк в таблицы
- **DELETE FROM** - удаление строк из таблиц

## Структура проекта

```
prac1-mat/
├── src/              # Исходные файлы (.cpp)
├── include/          # Заголовочные файлы (.h)
├── examples/         # Примеры SQL команд
│   └── commands.txt
├── schema.json       # Конфигурация базы данных
├── Makefile          # Файл сборки
└── README.md         # Документация
```

## Компиляция

```bash
make
```

Или вручную:
```bash
g++ -std=c++17 -Wall -Wextra -Iinclude -o dbms src/*.cpp
```

## Запуск

```bash
./dbms
```

При запуске СУБД:
1. Читает конфигурацию из файла `schema.json`
2. Создает структуру директорий для хранения данных
3. Инициализирует таблицы с первичными ключами

## Конфигурация

Файл `schema.json` должен содержать:
- `name` - название схемы (будет использовано как имя директории)
- `tuples_limit` - максимальное количество строк в одном CSV файле
- `structure` - структура таблиц и их колонок

Пример:
```json
{
  "name": "Схема 1",
  "tuples_limit": 1000,
  "structure": {
    "таблица1": ["колонка1", "колонка2", "колонка3", "колонка4"],
    "таблица2": ["колонка1", "колонка2"]
  }
}
```

## Примеры запросов

Подробные примеры SQL команд находятся в файле `examples/commands.txt`

### SELECT
```sql
SELECT таблица1.колонка1, таблица2.колонка1 FROM таблица1, таблица2
```

С WHERE:
```sql
SELECT таблица1.колонка1, таблица2.колонка1 FROM таблица1, таблица2 WHERE таблица1.колонка1 = таблица2.колонка1 AND таблица1.колонка2 = 'string'
```

### INSERT
```sql
INSERT INTO таблица1 VALUES ('somedata', '12345')
```

### DELETE
```sql
DELETE FROM таблица1 WHERE таблица1.колонка1 = '123'
```

**Примечание:** Полный список примеров с подробными комментариями см. в `examples/commands.txt`

## Структура данных

Данные хранятся в следующей структуре:
```
<schema_name>/
  <table_name>/
    1.csv
    2.csv
    ...
    <table_name>_pk_sequence
    <table_name>_lock
```

- CSV файлы содержат данные таблиц
- Файл `_pk_sequence` хранит текущее значение первичного ключа
- Файл `_lock` используется для блокировки таблицы при изменении

## Особенности реализации

- Каждая таблица автоматически получает колонку первичного ключа `<table_name>_pk`
- При вставке первичный ключ автоматически увеличивается
- Таблицы блокируются при операциях INSERT и DELETE для предотвращения конфликтов
- Данные читаются последовательно для эффективного использования памяти
- Поддержка декартова произведения таблиц в SELECT запросах

